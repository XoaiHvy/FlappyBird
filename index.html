<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird JS - AeroX</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Aldrich&family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
	<!-- 1. M√ÄN H√åNH ƒêƒÇNG NH·∫¨P/ƒêƒÇNG K√ù (M·ªõi) -->
    <!-- ƒê·∫∑t c√°i n√†y l√™n ƒë·∫ßu ti√™n trong body ƒë·ªÉ n√≥ hi·ªán tr∆∞·ªõc -->
    <div id="authScreen" class="screen active">
        <div class="menu-overlay"></div>
        <div class="auth-container">
            <h1 class="auth-title">AeroX</h1>
            
            <div id="loginForm">
                <input type="text" id="loginUser" placeholder="Username" autocomplete="off">
                <input type="password" id="loginPass" placeholder="Password">
                <div class="auth-actions">
                    <button id="btnLogin" class="menu-btn large">Login</button>
                    <button id="btnSwitchToReg" class="menu-btn secondary">Register</button>
                </div>
            </div>

            <div id="registerForm" style="display: none;">
                <input type="text" id="regUser" placeholder="Choose Username" autocomplete="off">
                <input type="password" id="regPass" placeholder="Choose Password">
                <div class="auth-actions">
                    <button id="btnRegister" class="menu-btn large">Create Account</button>
                    <button id="btnSwitchToLogin" class="menu-btn secondary">Back to Login</button>
                </div>
            </div>
            <p id="authMessage" class="auth-msg"></p>
        </div>
    </div>
	
    <!-- 2. MENU SCREEN (S·ª≠a ƒë·ªïi) -->
    <!-- X√≥a class "active" ·ªü ƒë√¢y v√¨ authScreen s·∫Ω hi·ªán tr∆∞·ªõc -->
    <div id="menuScreen" class="screen">
        <video id="menuBgVideo" autoplay loop muted playsinline>
            <source src="assets/videos/menu_bg.mp4" type="video/mp4">
        </video>
        <div class="menu-overlay"></div>
        <div class="menu-content">
            <div class="menu-left">
                <!-- Th√™m id ƒë·ªÉ hi·ªÉn th·ªã t√™n ng∆∞·ªùi ch∆°i -->
                <h1 class="menu-title">AeroX</h1> 
                <div class="player-greeting">Welcome, <span id="displayUsername">Guest</span></div>
                
                <nav class="menu-nav">
                    <button id="playButton" class="menu-btn large">Play</button>
                    <button id="collectionButton" class="menu-btn">Collection</button>
                    <button id="profileButton" class="menu-btn">Profile</button>
                    <button id="logoutButton" class="menu-btn">Logout</button> <!-- Thay Exit b·∫±ng Logout -->
                </nav>
            </div>
            <div class="menu-right">
                <div class="top-right-elements">
                    <span class="quest-indicator">QUESTS</span>
                </div>
                <div class="booster-packs">0 BOOSTER PACKS</div>
            </div>
        </div>
    </div>
    <div id="modeScreen" class="screen">
    <div class="menu-overlay"></div>
    <div class="menu-content" style="flex-direction: column; align-items: center; justify-content: center;">
        <h2 class="menu-title" style="font-size: 4em; margin-bottom: 40px;">SELECT MODE</h2>
        <div style="display: flex; gap: 30px;">
            <button id="btnNormalMode" class="menu-btn large">NORMAL</button>
            <button id="btnCrazyMode" class="menu-btn large" style="color: #ff0055; text-shadow: 0 0 10px #ff0055;">CRAZY</button>
        </div>
        <button id="btnBackMode" class="menu-btn" style="margin-top: 30px;">Back</button>
    </div>
</div>
    <!-- COLLECTION SCREEN -->
    <div id="collectionScreen" class="screen">
 
        <div class="menu-overlay"></div>
        
        <div class="collection-content">
            <h2 class="collection-title">ARSENAL</h2>
            
            <div class="collection-body">
                <!-- C·ªôt ch·ªçn Chim -->
                <div class="collection-column">
                    <h3>DRAGON SKINS</h3>
                    <div class="skin-grid" id="birdGrid">

                    </div>
                </div>
    <div class="collection-column">
        <h3>OBSTACLES</h3>
        <div class="skin-grid" id="pipeGrid"></div>
    </div>
                <!-- C·ªôt ch·ªçn Map -->
                <div class="collection-column">
                    <h3>REALMS</h3>
                    <div class="skin-grid" id="mapGrid">
                  
                    </div>
                </div>
            </div>

            <button id="collectionBackBtn" class="menu-btn">Back to Menu</button>
        </div>
    </div>
	<div id="profileScreen" class="screen">
        <div class="menu-overlay"></div>
        <div class="collection-content"> <!-- T·∫≠n d·ª•ng l·∫°i style c·ªßa collection-content -->
            <h2 class="collection-title">PILOT DATA</h2>
            <div class="profile-card">
                <div class="profile-info">
                    <h3>Name: <span id="profileName">---</span></h3>
                    <h3>High Score: <span id="profileBest">0</span></h3>
                    <h3>Total Games: <span id="profileGames">0</span></h3>
                </div>
            </div>
            <button id="profileBackBtn" class="menu-btn">Back to Menu</button>
        </div>
    </div>
    <div id="gameScreen" class="screen">
        <video id="gameBgVideo" loop muted playsinline>
            <source src="assets/videos/game_bg.mp4" type="video/mp4">
        </video>

        <canvas id="gameCanvas"></canvas>
        <img id="domSnake1" src="assets/images/head_flip.gif" class="boss-overlay" style="display: none;">
        <img id="domSnake2" src="assets/images/head.gif"      class="boss-overlay" style="display: none;">
        <img id="domBigBoss" src="assets/images/head.gif"      class="boss-overlay" style="display: none;">
        <button id="pauseButton" class="game-button" aria-label="Pause">
            <svg class="pause-icon" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                <rect x="6" y="5" width="4" height="14" rx="1.5"></rect>
                <rect x="14" y="5" width="4" height="14" rx="1.5"></rect>
            </svg>
        </button>

        <div id="scoreDisplay" class="score-display">Score: 0</div>
        <div id="bossWarning" class="boss-warning">WARNING!<br>BOSS APPROACHING</div>
        <div id="bossHpBar"><div id="bossHpFill"></div></div>

        <!-- pause overlay (single copy) -->
        <div id="pauseOverlay" class="overlay">
            <div class="pause-panel">
                <h2>Paused</h2>
                <ul class="pause-menu" role="menu" aria-label="Pause menu">
                    <li><button id="resumeButton" class="pause-item" role="menuitem">Resume Game</button></li>
                    <li><button id="exitToMenuButton" class="pause-item" role="menuitem">Back to Main Menu</button></li>
                </ul>
                <p class="pause-hint">Press <kbd>Esc</kbd> to resume</p>
            </div>
        </div>

        <!-- 4. GAME OVER OVERLAY (S·ª≠a ƒë·ªïi) -->
    <div id="gameOverOverlay" class="overlay">
        <div class="gameover-wrap">
            <div class="gameover-title">
                <span class="go-line go-game">WHY YOU</span>
                <span class="go-line go-over">SO NOOB?</span>
            </div>
            
            <!-- Khu v·ª±c ƒëi·ªÉm s·ªë -->
            <div class="score-board">
                <div class="score-item">
                    <span>SCORE</span>
                    <span id="finalScore" class="score-val">0</span>
                </div>
                <div class="score-item">
                    <span>BEST</span>
                    <span id="finalBestScore" class="score-val high-val">0</span>
                </div>
            </div>
            <div id="newRecordMsg" class="new-record" style="display:none">NEW RECORD!</div>

            <div class="gameover-actions">
                <button id="retryButton" class="go-btn">Continue</button>
                <button id="gameOverExitButton" class="go-btn secondary">Exit to Menu</button>
            </div>
        </div>
    </div>
    <!-- === DEBUG UI PANEL (M·∫∑c ƒë·ªãnh ·∫®n) === -->
    <div id="debugPanel" style="display: none; position: fixed; top: 10px; right: 10px; width: 300px; max-height: 90vh; overflow-y: auto; background: rgba(0,0,0,0.85); color: #0f0; padding: 15px; border: 1px solid #0f0; border-radius: 8px; font-family: monospace; z-index: 9999;">
        
        <h3 style="margin-top:0; border-bottom: 1px solid #555; display: flex; justify-content: space-between;">
            <span>üîß DEBUG TOOL</span>
            <button onclick="window.toggleDebugPanel()" style="background:red; color:white; border:none; cursor:pointer;">X</button>
        </h3>

        <!-- 1. C√îNG T·∫ÆC HITBOX -->
        <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <label style="display: flex; align-items: center; cursor: pointer; color: white;">
                <input type="checkbox" id="chkDrawHitboxes" onchange="window.debugState.isDrawingHitboxes = this.checked">
                <span style="margin-left: 10px;">‚ö° Show Hitboxes (V·∫Ω khung ƒë·ªè)</span>
            </label>
            <div style="margin-top:5px; font-size: 0.8em; color: #aaa;">B·∫≠t c√°i n√†y ƒë·ªÉ th·∫•y Hitbox th·ª±c t·∫ø khi ƒë√°nh Boss.</div>
        </div>
        <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <label style="display: flex; align-items: center; cursor: pointer; color: gold;">
                <!-- M·∫∑c ƒë·ªãnh unchecked -->
                <input type="checkbox" id="chkGodMode" onchange="window.debugState.isGodMode = this.checked">
                <span style="margin-left: 10px;">üõ°Ô∏è GOD MODE (B·∫•t T·ª≠)</span>
            </label>
            <div style="margin-top:5px; font-size: 0.8em; color: #aaa;">B·∫≠t c√°i n√†y ƒë·ªÉ kh√¥ng bao gi·ªù ch·∫øt (Game Over b·ªã v√¥ hi·ªáu).</div>
        </div>
        <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <label style="display: flex; align-items: center; cursor: pointer; color: #00ffff;">
                <input type="checkbox" onchange="window.debugState.isBossFrozen = this.checked">
                <span style="margin-left: 10px;">‚ùÑÔ∏è FREEZE BOSS (ƒê√≥ng bƒÉng)</span>
            </label>
            <div style="margin-top:5px; font-size: 0.8em; color: #aaa;">D·ª´ng boss ƒë·ª©ng im ƒë·ªÉ soi k·ªπ t·ª´ng chi ti·∫øt.</div>
        </div>
        <!-- 2. TUNING CONFIG (Ch·ªânh s·ª≠a tr·ª±c ti·∫øp BOSS_CFG) -->
        <h4 style="color: yellow; margin: 10px 0 5px;">BOSS CONFIG</h4>
        <div class="debug-row" style="margin-bottom:5px;">
            <label>Scroll Speed: <span id="val_speed"></span></label>
            <input type="range" min="1" max="5" step="0.1" style="width:100%" 
                oninput="BOSS_CFG.scrollSpeed = parseFloat(this.value); document.getElementById('val_speed').innerText = this.value">
        </div>
        
        <!-- 3. HITBOX TUNING (Ch·ªânh s·ª≠a HITBOX_CFG) -->
        <h4 style="color: cyan; margin: 10px 0 5px;">HITBOX OFFSET</h4>
        <label>Ch·ªçn Part:</label>
        <select id="selHbPart" onchange="window.updateDebugInputs()" style="width: 100%; background: #333; color: white; margin-bottom: 5px;">
            <option value="body">Body</option>
            <option value="head">Head</option>
            <option value="skill">Skill (Ghost)</option>
        </select>
        
        <div class="debug-row">
            Width: <input type="number" id="inp_w" onchange="window.applyHitboxChange()">
        </div>
        <div class="debug-row">
            Height: <input type="number" id="inp_h" onchange="window.applyHitboxChange()">
        </div>
        <div class="debug-row">
            Offset X: <input type="number" id="inp_dx" onchange="window.applyHitboxChange()">
        </div>
        <div class="debug-row">
            Offset Y: <input type="number" id="inp_dy" onchange="window.applyHitboxChange()">
        </div>

        <button onclick="console.log(JSON.stringify(window.HITBOX_CFG, null, 2))" style="width:100%; margin-top: 10px; background: #333; color: #0f0; border: 1px solid #0f0; cursor: pointer; padding: 5px;">
            üñ®Ô∏è In Config ra Console
        </button>
        <h4 style="color: #bc13fe; margin: 15px 0 5px; border-top: 1px solid #555; padding-top: 10px;">üêç VISUAL EDITOR (BOSS)</h4>

        <!-- TABS (T√πy ch·ªçn cho g·ªçn, ·ªü ƒë√¢y l√†m danh s√°ch d·ªçc cho d·ªÖ) -->

        <!-- SECTION: R·∫ÆN CON (Th√¢n & ƒê·∫ßu nh·ªè) -->
        <details open>
            <summary style="cursor:pointer; color:#0ff;">Small Snake Settings</summary>
            
            <!-- V·ªä TR√ç (Th√™m m·ªõi ƒë·ªÉ s·ª≠a l·ªói r·ªìng ch√¨m) -->
            <div class="debug-row">Y TOP (Kho·∫£ng c√°ch m√©p tr√™n): <span id="v_yt"></span> <input type="range" min="0" max="600" id="rng_yt" oninput="upVis('yTop', this.value)"></div>
            <div class="debug-row">Y BOT (Kho·∫£ng c√°ch m√©p d∆∞·ªõi): <span id="v_yb"></span> <input type="range" min="0" max="600" id="rng_yb" oninput="upVis('yBot', this.value)"></div>
            <hr style="border-color:#444">

            <!-- Body Size -->
            <div class="debug-row">Body W: <span id="v_bw"></span> <input type="range" min="100" max="2000" id="rng_bw" oninput="upVis('bodyW', this.value)"></div>
            <div class="debug-row">Body H: <span id="v_bh"></span> <input type="range" min="50" max="1000" id="rng_bh" oninput="upVis('bodyH', this.value)"></div>
            <div class="debug-row">Body Gap: <span id="v_bg"></span> <input type="range" min="100" max="1500" id="rng_bg" oninput="upVis('gap', this.value)"></div>
            <div class="debug-row">Body Rot: <span id="v_br"></span> <input type="range" min="-180" max="180" step="1" id="rng_br" oninput="upVis('bodyRot', this.value)"></div>

            <hr style="border-color:#444">

            <!-- Head Size -->
            <div class="debug-row">Head W: <span id="v_hw"></span> <input type="range" min="100" max="1000" id="rng_hw" oninput="upVis('headW', this.value)"></div>
            <div class="debug-row">Head H: <span id="v_hh"></span> <input type="range" min="100" max="1000" id="rng_hh" oninput="upVis('headH', this.value)"></div>
            <div class="debug-row">Head Offset X: <span id="v_hox"></span> <input type="range" min="-500" max="500" id="rng_hox" oninput="upVis('headOffX', this.value)"></div>
            <div class="debug-row">Head Offset Y: <span id="v_hoy"></span> <input type="range" min="-500" max="500" id="rng_hoy" oninput="upVis('headOffY', this.value)"></div>
            <div class="debug-row">Head Rot: <span id="v_hr"></span> <input type="range" min="-180" max="180" id="rng_hr" oninput="upVis('headRot', this.value)"></div>
        </details>

        <!-- SECTION: BOSS L·ªöN (Th√™m m·ªõi ch·ªânh Pos) -->
        <details>
            <summary style="cursor:pointer; color:#ff0055;">Big Boss Settings</summary>
            <div class="debug-row">Size: <span id="v_gs"></span> <input type="range" min="200" max="1500" id="rng_gs" oninput="window.BOSS_VISUAL.bigBoss.size = parseFloat(this.value); document.getElementById('v_gs').innerText=this.value;"></div>
            
            <div class="debug-row">Pos X (% m√†n h√¨nh): <span id="v_gpx"></span> 
                <input type="range" min="0" max="1" step="0.01" id="rng_gpx" oninput="window.BOSS_VISUAL.bigBoss.posX = parseFloat(this.value); document.getElementById('v_gpx').innerText=this.value;">
            </div>
            <div class="debug-row">Pos Y (% m√†n h√¨nh): <span id="v_gpy"></span> 
                <input type="range" min="0" max="1" step="0.01" id="rng_gpy" oninput="window.BOSS_VISUAL.bigBoss.posY = parseFloat(this.value); document.getElementById('v_gpy').innerText=this.value;">
            </div>
        </details>

        <!-- Script gi·ªØ gi√° tr·ªã (C·∫≠p nh·∫≠t th√™m d√≤ng load Y) -->
        <script>
        // --- VISUAL EDITOR UTILS ---
        
        // H√†m Save
            function saveAndReload() {
                localStorage.setItem('flappyBossVisual', JSON.stringify(window.BOSS_VISUAL));
                alert("ƒê√£ l∆∞u c·∫•u h√¨nh Boss! (F5 kh√¥ng m·∫•t)");
            }

            // H√†m Reset
            function resetVisualDefaults() {
                if(confirm("V·ªÅ m·∫∑c ƒë·ªãnh?")) {
                    localStorage.removeItem('flappyBossVisual');
                    location.reload(); 
                }
            }
            
            // H√†m n√†y ƒë∆∞·ª£c g·ªçi m·ªói khi k√©o thanh tr∆∞·ª£t (oninput)
            function upVis(key, val) {
                val = parseFloat(val);
                if(window.BOSS_VISUAL && window.BOSS_VISUAL.snake) {
                    // C·∫≠p nh·∫≠t v√†o bi·∫øn to√†n c·ª•c ngay l·∫≠p t·ª©c
                    window.BOSS_VISUAL.snake[key] = val;
                    
                    // C·∫≠p nh·∫≠t s·ªë hi·ªÉn th·ªã b√™n c·∫°nh thanh tr∆∞·ª£t
                    let map = {
                        'bodyW': 'v_bw', 'bodyH': 'v_bh', 'bodyRot': 'v_br', 'gap': 'v_bg',
                        'headW': 'v_hw', 'headH': 'v_hh', 'headOffX': 'v_hox', 'headOffY': 'v_hoy', 'headRot': 'v_hr',
                        'yTop': 'v_yt', 'yBot': 'v_yb'
                    };
                    if(map[key]) {
                        let el = document.getElementById(map[key]);
                        if(el) el.innerText = val;
                    }
                }
            }

            // H√†m n√†y g·ªçi khi m·ªü Debug Panel ƒë·ªÉ ƒë·ªìng b·ªô s·ªë li·ªáu
            function syncDebugInputs() {
                if(!window.BOSS_VISUAL) return; 
                const S = window.BOSS_VISUAL.snake;
                const G = window.BOSS_VISUAL.bigBoss;
                
                const setVal = (id, val, txtId) => {
                    let el = document.getElementById(id);
                    if(el) el.value = val;
                    let txt = document.getElementById(txtId);
                    if(txt) txt.innerText = val;
                }

                setVal('rng_bw', S.bodyW, 'v_bw');
                setVal('rng_bh', S.bodyH, 'v_bh');
                setVal('rng_br', S.bodyRot, 'v_br');
                setVal('rng_bg', S.gap, 'v_bg');
                
                // Y Pos
                setVal('rng_yt', S.yTop || 130, 'v_yt');
                setVal('rng_yb', S.yBot || 130, 'v_yb');
                
                // Head
                setVal('rng_hw', S.headW, 'v_hw');
                setVal('rng_hh', S.headH, 'v_hh');
                setVal('rng_hox', S.headOffX, 'v_hox');
                setVal('rng_hoy', S.headOffY, 'v_hoy');
                setVal('rng_hr', S.headRot, 'v_hr');

                // Big Boss
                setVal('rng_gs', G.size, 'v_gs');
                setVal('rng_gpx', G.posX, 'v_gpx');
                setVal('rng_gpy', G.posY, 'v_gpy');
            }
            
            // G·∫Øn v√†o n√∫t m·ªü
            const oldToggle = window.toggleDebugPanel;
            window.toggleDebugPanel = function() {
                if(oldToggle) oldToggle(); // G·ªçi h√†m c≈© (b·∫≠t/t·∫Øt div)
                syncDebugInputs(); // Load d·ªØ li·ªáu
            };
        </script>
    </div>

    <!-- N√∫t M·ªü Debug nh·ªè ·ªü g√≥c (Ch·ªâ hi·ªán khi hover ho·∫∑c c·∫ßn thi·∫øt, m·∫∑c ƒë·ªãnh ta ·∫©n, g·ªçi l·ªánh console ƒë·ªÉ hi·ªán) -->
    <script src="script.js"></script>
</body>
</html>
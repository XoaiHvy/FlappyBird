<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hitbox Editor</title>
    <style>
        body { background: #111; color: white; display: flex; font-family: monospace; }
        .panel { width: 300px; padding: 20px; background: #222; height: 100vh; }
        .view { flex: 1; background: #000; position: relative; display: flex; justify-content: center; align-items: center; }
        canvas { border: 1px solid green; }
        .grp { border-bottom: 1px solid #444; margin-bottom: 15px; padding-bottom: 10px; }
        h3 { margin-top:0; color: lime;}
        input { width: 80px; background:#000; color:lime; border:1px solid #555; }
        button { padding: 10px; width: 100%; margin-top:20px; font-weight: bold; background: lime; cursor:pointer;}
    </style>
</head>
<body>
    <div class="panel">
        <h2>üì¶ HITBOX TUNER</h2>
        <select id="selObj" onchange="currObj=this.value" style="width:100%; padding:10px; margin-bottom:20px;">
            <option value="body">1. Th√¢n R·∫Øn (Body)</option>
            <option value="head">2. ƒê·∫ßu R·∫Øn (Head)</option>
            <option value="skill">3. Big Boss (Ghost)</option>
            <option value="player">4. Ng∆∞·ªùi ch∆°i (Dragon)</option>
        </select>

        <div class="grp">
            <p>Width: <input type="number" id="w" oninput="upHb()"></p>
            <p>Height: <input type="number" id="h" oninput="upHb()"></p>
            <p>Off X: <input type="number" id="dx" oninput="upHb()"></p>
            <p>Off Y: <input type="number" id="dy" oninput="upHb()"></p>
        </div>
        <button onclick="save()">L∆ØU HITBOX</button>
        <div id="savedMsg" style="color:lime; margin-top:10px; display:none">ƒê√£ L∆∞u!</div>
    </div>
    <div class="view">
        <canvas id="c" width="800" height="600"></canvas>
    </div>

<script>
    // LOAD EXISTING OR DEFAULT
    const DEF_HB = {
        body: { w: 900, h: 250, dx: 0, dy: 10 },
        head: { w: 300, h: 500, dx: 10, dy: 10 },
        skill: { w: 605, h: 800, dx: 15, dy: -12 },
        player: { w: 45, h: 45, dx: 0, dy: 0 },
    };
    let DATA = JSON.parse(localStorage.getItem('flappyHitboxCfg')) || DEF_HB;

    // Assets
    const imgs = { 
        body: new Image(), head: new Image(), skill: new Image(), player: new Image()
    };
    imgs.body.src = 'assets/images/body.png';
    imgs.head.src = 'assets/images/head.gif';
    imgs.skill.src = 'assets/images/head.gif'; // Big boss
    imgs.player.src = 'assets/images/dragon.png';

    let currObj = 'body';
    const cvs = document.getElementById('c');
    const ctx = cvs.getContext('2d');

    // Sync Input
    function loadInputs() {
        const t = DATA[currObj];
        document.getElementById('w').value = t.w;
        document.getElementById('h').value = t.h;
        document.getElementById('dx').value = t.dx;
        document.getElementById('dy').value = t.dy;
    }
    loadInputs();

    function upHb() {
        const t = DATA[currObj];
        t.w = parseFloat(document.getElementById('w').value);
        t.h = parseFloat(document.getElementById('h').value);
        t.dx = parseFloat(document.getElementById('dx').value);
        t.dy = parseFloat(document.getElementById('dy').value);
    }

    function save() {
        // M·∫πo: Trong script.js game ch√≠nh, b·∫°n c·∫ßn s·ª≠a d√≤ng ƒë·ªçc hitbox th√†nh ƒë·ªçc t·ª´ localStorage n√†y
        // Hi·ªán t·∫°i script.js ƒëang d√πng c·ª©ng. 
        // T√¥i s·∫Ω h∆∞·ªõng d·∫´n s·ª≠a script.js ƒë·ªÉ ƒë·ªçc c√°i n√†y.
        alert("Copy ƒëo·∫°n JSON n√†y thay v√†o window.HITBOX_CFG trong script.js (V√¨ Game ch∆∞a c√≥ ch·ª©c nƒÉng ƒë·ªçc Hitbox ƒë·ªông, nh∆∞ng copy tay s·∫Ω an to√†n h∆°n): \n\n" + JSON.stringify(DATA));
    }

    // DRAW LOOP
    function draw() {
        ctx.clearRect(0,0, cvs.width, cvs.height);
        ctx.fillStyle = '#222'; ctx.fillRect(0,0, cvs.width, cvs.height);
        
        // V·∫Ω l∆∞·ªõi t√¢m
        const cx = cvs.width/2; const cy = cvs.height/2;
        ctx.strokeStyle='#444'; ctx.beginPath(); ctx.moveTo(cx,0); ctx.lineTo(cx,cvs.height); ctx.moveTo(0,cy); ctx.lineTo(cvs.width, cy); ctx.stroke();

        // 1. V·∫Ω ·∫¢nh (Center)
        const img = imgs[currObj];
        if(img.complete) {
            let s = (currObj === 'player') ? 2 : 0.6;
            
            // GI·∫¢ L·∫¨P G√ìC XOAY (V√≠ d·ª• Body nghi√™ng 3 ƒë·ªô)
            let rot = (currObj==='body') ? 3 : 0; 
            
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(rot * Math.PI/180); // Xoay h√¨nh
            
            // V·∫Ω ·∫¢nh (L·ªách t√¢m ƒë·ªÉ rotate quanh gi·ªØa)
            let iw = img.width * s / (currObj.includes('head')?74:1); // Chia 74 frame n·∫øu l√† head
            let ih = img.height * s;
            
            // Crop frame 1 ƒë·ªÉ hi·ªán
            ctx.drawImage(img, 0,0,img.width/(currObj.includes('head')?74:1),img.height, -iw/2, -ih/2, iw, ih);

            // V·∫º HITBOX XOAY THEO
            const hb = DATA[currObj];
            ctx.strokeStyle = 'red'; ctx.lineWidth = 2; ctx.fillStyle = 'rgba(255,0,0,0.3)';
            
            // Box t√≠nh t·ª´ t√¢m
            ctx.beginPath();
            ctx.rect(hb.dx - hb.w/2, hb.dy - hb.h/2, hb.w, hb.h);
            ctx.stroke(); ctx.fill();
            
            ctx.restore();
        }
        
        loadInputs(); // Refresh value (dirty way but works)
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
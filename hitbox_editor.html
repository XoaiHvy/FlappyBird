<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hitbox Editor v3 (Live GIF)</title>
    <style>
        body { background: #1a1a1a; color: #ddd; font-family: 'Segoe UI', monospace; display: flex; gap: 20px; padding: 20px; height: 95vh; overflow: hidden; }
        .controls { width: 340px; background: #2b2b2b; padding: 20px; border-radius: 8px; overflow-y: auto; display:flex; flex-direction:column; gap:10px; border:1px solid #444; height: 100%; box-sizing: border-box; }
        
        /* CONTAINER CH√çNH: QUAN TR·ªåNG ƒê·ªÇ CƒÇN GI·ªÆA */
        .preview-container { 
            flex: 1; 
            position: relative; 
            background: #000; 
            border: 2px solid #555; 
            overflow: hidden; 
            background-image: radial-gradient(#222 15%, transparent 16%);
            background-size: 20px 20px;
        }

        /* ·∫¢NH GIF TH·∫¨T: S·∫Ω n·∫±m gi·ªØa m√†n h√¨nh */
        #refImage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 50% 50%; /* Xoay t·ª´ t√¢m */
            pointer-events: none; /* Click xuy√™n qua */
            /* M·∫∑c ƒë·ªãnh ch∆∞a set transform, JS s·∫Ω set */
            opacity: 0.8;
        }

        /* CANVAS V·∫º HITBOX: ƒê√® l√™n ·∫£nh */
        #cvs {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }
        
        .row { display:flex; justify-content: space-between; align-items: center; font-size: 12px; }
        label { color:#aaa; width: 80px; }
        input[type=range] { flex:1; margin: 0 10px; accent-color: #00e676; }
        .val { color: cyan; font-weight: bold; width: 40px; text-align: right; }
        
        textarea { width: 100%; height: 120px; background: #000; color: #0f0; border: 1px solid #444; font-size: 11px; font-family: monospace; resize: none; padding:5px; margin-top: auto;}
        select { width:100%; padding:8px; background:#111; color:#fff; border:1px solid #555; margin-bottom:10px; font-weight: bold;}
        h3, h4 { margin:0; color: #00e676; border-bottom:1px solid #444; padding-bottom:5px; }
        
        .warn { font-size: 11px; color: #ff9800; margin-bottom: 10px; font-style: italic;}
    </style>
</head>
<body>

<div class="controls">
    <h3>üî¥ LIVE GIF EDITOR V3</h3>
    <div class="warn">Gi·ªù ·∫£nh l√† GIF th·∫≠t, h√£y k√©o hitbox bao tr·ªçn kho·∫£nh kh·∫Øc ·∫£nh ph√¨nh to nh·∫•t.</div>
    
    <select id="objType" onchange="changeObj()">
        <option value="body">1. Snake Body (Static)</option>
        <option value="head">2. Snake Head (GIF)</option>
        <option value="skill">3. Skill Ghost (GIF) [Scale 1.6]</option>
        <option value="player">4. Player Dragon (Img)</option>
    </select>

    <!-- HITBOX LOGIC -->
    <h4>üî∂ HITBOX (Khung ƒê·ªè)</h4>
    <div class="row"><label>Width</label><input type="range" id="w" min="10" max="1500" oninput="update()"><span class="val" id="vw">0</span></div>
    <div class="row"><label>Height</label><input type="range" id="h" min="10" max="800" oninput="update()"><span class="val" id="vh">0</span></div>
    <div class="row"><label>Hitbox X</label><input type="range" id="dx" min="-600" max="600" oninput="update()"><span class="val" id="vdx">0</span></div>
    <div class="row"><label>Hitbox Y</label><input type="range" id="dy" min="-600" max="600" oninput="update()"><span class="val" id="vdy">0</span></div>

    <!-- GAME VISUAL SIMULATION -->
    <h4 style="margin-top:20px; color:#ffeb3b">üëÅÔ∏è ·∫¢NH HI·ªÇN TH·ªä (GIF)</h4>
    <div class="row"><label>Image Size</label><input type="range" id="dispSize" min="50" max="1500" oninput="update()"><span class="val" id="vDispSize">0</span></div>
    <div class="row"><label>Scale</label><input type="range" id="dispScale" min="0.1" max="3.0" step="0.1" oninput="update()"><span class="val" id="vDispScale">1.0</span></div>
    <div class="row"><label>Rotation</label><input type="range" id="dispRot" min="-180" max="180" step="1" oninput="update()"><span class="val" id="vDispRot">0</span></div>

    <h4 style="margin-top:20px">üíæ JSON CODE</h4>
    <textarea id="output" readonly onclick="this.select()"></textarea>
</div>

<div class="preview-container">
    <!-- ·∫¢NH GIF S·ªêNG (IMG TAG) -->
    <img id="refImage" src="">
    <!-- L·ªöP V·∫º HITBOX -->
    <canvas id="cvs" width="1200" height="900"></canvas>
    
    <div style="position:absolute; top:10px; left:10px; color:lime; font-size:12px; pointer-events:none; text-shadow: 1px 1px 2px black;">
        [T√ÇM M√ÄN H√åNH L√Ä ƒêI·ªÇM NEO LOGIC (0,0)]
    </div>
</div>

<script>
    // TH√îNG S·ªê KH·ªöP V·ªöI GAME C·ª¶A B·∫†N
    // L∆∞u √Ω: dispSize ·ªü ƒë√¢y l√† Width, t√¥i s·∫Ω cho Height auto ƒë·ªÉ gi·ªØ t·ªâ l·ªá ·∫£nh GIF
    const DEFAULTS = {
        body:   { src: 'Image/body.png', w: 900, h: 220, dx: 0, dy: 10,   dispSize: 1000, rot: 3,  scale: 1.0 },
        head:   { src: 'Image/head.gif', w: 350, h: 300, dx: 0, dy: 30,   dispSize: 450,  rot: -4, scale: 1.0 },
        // Boss Ghost scale 1.6 nh∆∞ file code game
        skill:  { src: 'Image/head.gif', w: 550, h: 500, dx: 0, dy: 0,    dispSize: 500,  rot: 0,  scale: 1.6 }, 
        player: { src: 'Image/dragon.png', w: 50, h: 50, dx: 0, dy: 0,    dispSize: 80,   rot: 0,  scale: 1.0 }
    };

    const ctx = document.getElementById('cvs').getContext('2d');
    const refImg = document.getElementById('refImage');
    let currentKey = 'body';
    
    // Copy data to editable object
    let D = JSON.parse(JSON.stringify(DEFAULTS));

    function init() {
        changeObj();
    }

    function changeObj() {
        currentKey = document.getElementById('objType').value;
        const d = D[currentKey];

        // ƒê·ªïi ngu·ªìn ·∫£nh th·∫≠t
        refImg.src = DEFAULTS[currentKey].src;
        // Reset animation GIF b·∫±ng c√°ch reload src (m·∫πo nh·ªè)
        let cleanSrc = refImg.src; refImg.src = ""; refImg.src = cleanSrc;

        // Set gi√° tr·ªã v√†o input
        setVal('w', d.w); setVal('h', d.h); setVal('dx', d.dx); setVal('dy', d.dy);
        setVal('dispSize', d.dispSize); setVal('dispScale', d.scale); setVal('dispRot', d.rot);

        update();
    }
    
    function setVal(id, v) { 
        document.getElementById(id).value = v; 
        if(document.getElementById('v'+id.charAt(0).toUpperCase() + id.slice(1))) {
             document.getElementById('v'+id.charAt(0).toUpperCase() + id.slice(1)).innerText = v;
        }
    }

    function getVal(id) { return parseFloat(document.getElementById(id).value); }

    function update() {
        const d = D[currentKey];
        // 1. Nh·∫≠n gi√° tr·ªã
        d.w = parseInt(getVal('w'));
        d.h = parseInt(getVal('h'));
        d.dx = parseInt(getVal('dx'));
        d.dy = parseInt(getVal('dy'));
        d.dispSize = parseInt(getVal('dispSize'));
        d.scale = getVal('dispScale');
        d.rot = parseInt(getVal('dispRot'));

        // 2. Update Label UI
        document.getElementById('vw').innerText = d.w; document.getElementById('vh').innerText = d.h;
        document.getElementById('vdx').innerText = d.dx; document.getElementById('vdy').innerText = d.dy;
        document.getElementById('vDispSize').innerText = d.dispSize;
        document.getElementById('vDispScale').innerText = d.scale;
        document.getElementById('vDispRot').innerText = d.rot + '¬∞';

        // 3. APPLY STYLE CHO ·∫¢NH (DOM)
        // T√¢m ·∫£nh ƒë·∫∑t t·∫°i 50% 50% c·ªßa khung
        // D√πng CSS Transform ƒë·ªÉ Xoay & Scale y chang logic Canvas
        refImg.style.width = d.dispSize + 'px';
        refImg.style.height = 'auto'; // Auto height ƒë·ªÉ ·∫£nh kh√¥ng b·ªã m√©o
        
        // C√îNG TH·ª®C CSS MATCH V·ªöI LOGIC CANVAS:
        // translate(-50%, -50%) ƒë·ªÉ ƒë∆∞a t√¢m ·∫£nh v·ªÅ ƒë√∫ng ƒëi·ªÉm neo
        refImg.style.transform = `translate(-50%, -50%) rotate(${d.rot}deg) scale(${d.scale})`;

        // 4. V·∫º HITBOX L√äN CANVAS
        drawCanvas(d);

        // 5. XU·∫§T CODE JSON
        let out = `const HITBOX_CFG = {\n`;
        for(let k in DEFAULTS) {
            let p = D[k];
            // Body th√¨ m√¨nh ch·ªâ ƒë·ªãnh W, H c√≤n Skill Ghost scale n√™n w, h kh√°c
            out += `    ${k}: { w: ${p.w}, h: ${p.h}, dx: ${p.dx}, dy: ${p.dy} },\n`;
        }
        out += `};`;
        document.getElementById('output').value = out;
    }

    function drawCanvas(d) {
        // Clear canvas
        ctx.clearRect(0,0, 1200, 900);
        
        // Center c·ªßa Canvas (ph·∫£i tr√πng v·ªõi center c·ªßa khung ch·ª©a div.preview-container)
        // V√¨ canvas w=1200, h=900 -> Center = 600, 450
        const cx = 600, cy = 450;

        // V·∫Ω T√¢m Neo (ƒêi·ªÉm Xanh)
        ctx.fillStyle = '#00e676';
        ctx.beginPath(); ctx.arc(cx, cy, 5, 0, Math.PI*2); ctx.fill();
        ctx.moveTo(cx-1000, cy); ctx.lineTo(cx+1000, cy);
        ctx.moveTo(cx, cy-1000); ctx.lineTo(cx, cy+1000);
        ctx.strokeStyle='rgba(0, 230, 118, 0.3)'; ctx.lineWidth=1; ctx.stroke();

        // V·∫Ω Khung Hitbox
        ctx.strokeStyle = '#ff3d00'; // M√†u ƒë·ªè cam
        ctx.lineWidth = 4;
        ctx.fillStyle = 'rgba(255, 61, 0, 0.25)'; // M·ªù b√™n trong

        // T√≠nh t·ªça ƒë·ªô v·∫Ω (Box AABB kh√¥ng xoay)
        // cx + dx - w/2
        let bx = cx + d.dx - d.w/2;
        let by = cy + d.dy - d.h/2;
        
        ctx.fillRect(bx, by, d.w, d.h);
        ctx.strokeRect(bx, by, d.w, d.h);

        // Ch√∫ th√≠ch
        ctx.fillStyle = 'white'; ctx.font="14px monospace";
        ctx.fillText(`HITBOX: ${d.w}x${d.h}`, bx, by - 10);
    }
    
    // M·∫πo nh·ªè: CSS ch·ªânh preview-container canh gi·ªØa refImage
    // refImg position absolute top 50% left 50%.
    // canvas cx, cy c≈©ng ph·∫£i t∆∞∆°ng ·ª©ng visual center c·ªßa div.

    init();
</script>
</body>
</html>
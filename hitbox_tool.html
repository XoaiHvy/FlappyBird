<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Gap: Hitbox Tuning Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', monospace;
            background-color: #222;
            color: #ddd;
            display: flex;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: 350px;
            background: #1a1a1a;
            border-right: 1px solid #444;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        h2 { margin: 0 0 10px 0; color: #00ff88; text-transform: uppercase; font-size: 18px; }
        
        .asset-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 10px;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
            border-radius: 4px;
        }
        .asset-btn:hover { background: #444; }
        .asset-btn.active { background: #005533; border-color: #00ff88; font-weight: bold; }

        /* --- CONTROL GROUP --- */
        .control-group {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        label { font-size: 14px; width: 60px; color: #aaa; }
        input[type="range"] { flex: 1; margin: 0 10px; cursor: pointer; }
        input[type="number"] { width: 60px; background: #111; color: #0f0; border: 1px solid #444; padding: 4px; }

        /* --- PREVIEW AREA --- */
        #preview-area {
            flex: 1;
            background-image: 
                linear-gradient(45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(-45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #2a2a2a 75%), 
                linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* --- OBJECT VISUALIZATION --- */
        #stage-wrapper {
            position: relative;
            /* Border border outline to see entity bounds */
            border: 1px dashed rgba(255, 255, 255, 0.3); 
        }

        #target-img {
            display: block;
            image-rendering: pixelated;
            /* Default transform */
            transform-origin: center;
        }

        /* Snake 2 Specific Flip */
        .flipped-mode { transform: scaleX(-1); }

        #hitbox-vis {
            position: absolute;
            border: 2px solid rgba(255, 0, 0, 0.9);
            background-color: rgba(255, 0, 0, 0.3);
            pointer-events: none;
            box-sizing: border-box;
        }

        /* Axis Lines */
        .axis { position: absolute; background: cyan; opacity: 0.3; pointer-events: none; }
        .axis-x { width: 100%; height: 1px; top: 50%; left: 0; }
        .axis-y { width: 1px; height: 100%; left: 50%; top: 0; }

        /* --- OUTPUT AREA --- */
        #output-code {
            position: fixed; bottom: 20px; right: 20px;
            width: 400px; height: 150px;
            background: #111; color: #00ff88;
            border: 2px solid #00ff88;
            font-family: monospace; font-size: 12px;
            padding: 10px;
            opacity: 0.9;
        }
        #copy-msg { 
            position: fixed; bottom: 175px; right: 20px; color: yellow; display: none; font-weight: bold; 
        }
    </style>
</head>
<body>

    <!-- SIDEBAR: Controls -->
    <div id="sidebar">
        <h2>Hitbox Tool</h2>
        <div id="asset-list">
            <!-- Asset buttons injected by JS -->
        </div>

        <div class="control-group">
            <div class="control-row" style="color: cyan; font-weight: bold; text-align: center; display:block; margin-bottom:10px">
                OFFSET & SIZE (px)
            </div>

            <!-- OFFSET X -->
            <div class="control-row">
                <label>Off X</label>
                <input type="range" id="sl-x" min="-200" max="200">
                <input type="number" id="nb-x">
            </div>

            <!-- OFFSET Y -->
            <div class="control-row">
                <label>Off Y</label>
                <input type="range" id="sl-y" min="-200" max="200">
                <input type="number" id="nb-y">
            </div>

            <!-- WIDTH -->
            <div class="control-row">
                <label>Width</label>
                <input type="range" id="sl-w" min="0" max="800">
                <input type="number" id="nb-w">
            </div>

            <!-- HEIGHT -->
            <div class="control-row">
                <label>Height</label>
                <input type="range" id="sl-h" min="0" max="800">
                <input type="number" id="nb-h">
            </div>
        </div>

        <div style="font-size:12px; color:#888;">
            * Tip: Kéo trượt hoặc gõ số để chỉnh.<br>
            * Snake 2 được lật sẵn ScaleX(-1).<br>
            * Output bên dưới tự động cập nhật.
        </div>
    </div>

    <!-- MAIN STAGE -->
    <div id="preview-area">
        <!-- Lines for center reference -->
        <div class="axis axis-x"></div>
        <div class="axis axis-y"></div>

        <div id="stage-wrapper">
            <img id="target-img" src="" alt="Asset">
            <div id="hitbox-vis"></div>
        </div>
    </div>

    <div id="copy-msg">Code copied! Paste this to ChatGPT.</div>
    <textarea id="output-code" readonly onclick="this.select()"></textarea>

    <script>
        // === 1. DATABASE CẤU HÌNH BAN ĐẦU ===
        const CONFIG = {
            'player': {
                name: 'Player Dragon',
                src: 'Image/dragon.png',
                baseW: 80, // Chiều rộng gốc để hiển thị
                x: 30, y: 30, w: 40, h: 25,
                flip: false
            },
            'baby': {
                name: 'Baby Snake',
                src: 'Image/child.png',
                baseW: 120, 
                x: 15, y: 8, w: 90, h: 15,
                flip: true // Ảnh gốc child.png đầu sang phải -> Cần lật để đầu sang trái
            },
            'bullet': {
                name: 'Poison Bullet',
                src: 'Image/posionbullet.png',
                baseW: 120, // Kích thước hiển thị to như bản fix trước
                x: 30, y: 30, w: 60, h: 60, // Hitbox mẫu
                flip: false
            },
            'puddle': {
                name: 'Poison Puddle (Area)',
                src: 'Image/posionarea.png',
                baseW: 100, 
                x: 10, y: 10, w: 80, h: 80,
                flip: false
            },
            'snake2_head': {
                name: 'Snake 2 Head (Flipped)',
                src: 'Image/head.gif',
                baseW: 450, 
                x: 50, y: 100, w: 200, h: 150,
                flip: true // Snake 2 luôn bị lật ScaleX(-1) trong game
            }
        };

        // --- STATE ---
        let currentKey = 'player';
        
        // --- ELEMENTS ---
        const uiList = document.getElementById('asset-list');
        const elImg = document.getElementById('target-img');
        const elBox = document.getElementById('hitbox-vis');
        const elWrapper = document.getElementById('stage-wrapper');
        const output = document.getElementById('output-code');

        const inputs = {
            x: { sl: document.getElementById('sl-x'), nb: document.getElementById('nb-x') },
            y: { sl: document.getElementById('sl-y'), nb: document.getElementById('nb-y') },
            w: { sl: document.getElementById('sl-w'), nb: document.getElementById('nb-w') },
            h: { sl: document.getElementById('sl-h'), nb: document.getElementById('nb-h') },
        };

        // === 2. SETUP UI & LOGIC ===

        function init() {
            // Tạo buttons
            for (let key in CONFIG) {
                let btn = document.createElement('div');
                btn.className = 'asset-btn';
                btn.innerText = CONFIG[key].name;
                btn.onclick = () => selectAsset(key);
                btn.dataset.key = key;
                uiList.appendChild(btn);
            }

            // Bind sự kiện cho Input
            ['x', 'y', 'w', 'h'].forEach(p => {
                // Khi kéo Slider -> Update Number & Render
                inputs[p].sl.addEventListener('input', (e) => {
                    let val = parseInt(e.target.value);
                    CONFIG[currentKey][p] = val;
                    inputs[p].nb.value = val;
                    renderBox();
                });
                // Khi gõ Number -> Update Slider & Render
                inputs[p].nb.addEventListener('input', (e) => {
                    let val = parseInt(e.target.value);
                    CONFIG[currentKey][p] = val;
                    inputs[p].sl.value = val;
                    renderBox();
                });
            });

            // Chọn mặc định
            selectAsset('player');
        }

        function selectAsset(key) {
            currentKey = key;
            const data = CONFIG[key];

            // 1. Update List Styles
            document.querySelectorAll('.asset-btn').forEach(b => {
                b.classList.toggle('active', b.dataset.key === key);
            });

            // 2. Load Image
            elImg.src = data.src;
            elImg.style.width = data.baseW + 'px'; // Set width cố định theo hiển thị game
            elImg.style.height = 'auto';
            
            // Xử lý Flip
            if(data.flip) elImg.className = 'flipped-mode';
            else elImg.className = '';

            // 3. Reset Inputs về giá trị của asset đó
            syncInputs();
            renderBox();
        }

        function syncInputs() {
            const data = CONFIG[currentKey];
            ['x', 'y', 'w', 'h'].forEach(p => {
                inputs[p].sl.value = data[p];
                inputs[p].nb.value = data[p];
            });
        }

        function renderBox() {
            const data = CONFIG[currentKey];
            
            // Cập nhật vị trí Red Box
            elBox.style.left = data.x + 'px';
            elBox.style.top = data.y + 'px';
            elBox.style.width = data.w + 'px';
            elBox.style.height = data.h + 'px';

            generateCode();
        }

        function generateCode() {
            // Tạo chuỗi JSON đơn giản dễ copy
            // Ta loại bỏ các trường râu ria, chỉ lấy x, y, w, h
            let cleanConfig = {};
            for(let k in CONFIG) {
                let d = CONFIG[k];
                cleanConfig[k] = { x: d.x, y: d.y, w: d.w, h: d.h };
            }

            let text = "COPY TOÀN BỘ DÒNG NÀY GỬI CHO CHATGPT:\n\n";
            text += JSON.stringify(cleanConfig, null, 2);
            output.value = text;
        }

        // Run
        init();

    </script>
</body>
</html>